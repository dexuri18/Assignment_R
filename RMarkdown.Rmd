---
title: "The Weight and Hindfoot Length Relationships of Rodents in Southern Arizona"
author: "Deky and Tono"
date: "March 31, 2018"
output:
  html_document: default
  pdf_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(gridExtra)
library("ggpubr")
```

## Summary of the Data

Data used in this assignment was derived from the time series data which were collected from 1977 to 2002 with the total numbers of recorded data is 34,786.  However, we found that some of the records are incomplete which could lead to bias in our analysis. Therefore, we excluded the incomplete data in our further analysis. The comparison of the complete and incomplete data entries can be seen in Figure below.



```{r plot1, echo=FALSE}
surveys <- read.csv("data/portal_data_joined.csv") 

count_all_records <- surveys %>% tally()
count_complete <- surveys %>%
  filter(!is.na(hindfoot_length)) %>%
  filter(!is.na(weight)) %>%
  filter(sex !="") %>%
  filter(species_id !="") %>%
  tally()

count_unclomplete <- count_all_records - count_complete

slices <- c(count_complete[1,1],count_unclomplete[1,1])
lbls <- c("complete records", "uncomplete records")
pct <- round(slices/sum(slices)*100)
lbls <- paste(lbls, pct) # add percents to labels 
lbls <- paste(lbls,"%",sep="") # ad % to labels 

pie(slices,labels = lbls, col=rainbow(length(lbls)),
    main="Pie Chart of Data Completeness")
```

The figure below delineates the general patterns of the data based on the number of samples for each species and genus, also the proportion of sex (female and male) for each category. 

```{r plot_a,echo=FALSE}
#load the data
surveys <- read.csv("data/portal_data_joined.csv")

#clean the data from NA and blank value
surveys_complete <- surveys %>%
  filter(!is.na(hindfoot_length)) %>%
  filter(!is.na(weight)) %>%
  filter(sex !="") %>%
  filter(species_id !="")

#plotting the number of species and assign it to variable
species_plot <- ggplot(data = surveys_complete) + geom_bar(mapping = aes(x = species_id, fill = sex)) +
  theme(axis.text.x = element_text(size = 8, angle = 90))

#plotting the number of genus and assign it to variable
genus_plot <- ggplot(data = surveys_complete) + geom_bar(mapping = aes(x = genus, fill = sex)) + 
  theme(axis.text.x = element_text(angle = 30, size = 8))

#combine species plot and genus plot together
grid.arrange(species_plot, genus_plot, ncol=2, widths=c(8,7))

```

In addition to the general pattern of the data in the above, we also plotted the distribution of weight and hindfoot length for the overall sample and the distribution of the average (mean) weight and hindfoot length for each species, as follows: 

```{r plot_b,echo=FALSE}
#load the data
surveys <- read.csv("data/portal_data_joined.csv")

#clean the data from NA and blank value
surveys_complete <- surveys %>%
  filter(!is.na(hindfoot_length)) %>%
  filter(!is.na(weight)) %>%
  filter(sex !="") %>%
  filter(species_id !="")

#weight and hindfoot_length distribution 
weight_distribution <- ggplot(data = surveys_complete, aes(x = weight)) + 
  geom_histogram(stat = "bin", binwidth = 3)
hlength_distribution <- ggplot(data = surveys_complete, aes(x = hindfoot_length)) + 
  geom_histogram(stat = "bin", binwidth = 2)

#mean weight and hindfoot length for each species
weight_sum <- aggregate(surveys_complete["weight"], surveys_complete["species_id"], FUN = mean)
weight_sum_plot <- ggplot(weight_sum, aes(x = species_id, y = weight)) + 
  geom_bar(stat = "identity") + theme(axis.text.x = element_text(size = 8, angle = 90))

hlength_sum <- aggregate(surveys_complete["hindfoot_length"], surveys_complete["species_id"], FUN = mean)
hlength_sum_plot <- ggplot(hlength_sum, aes(x = species_id, y = hindfoot_length)) + 
  geom_bar(stat = "identity") + theme(axis.text.x = element_text(size = 8, angle = 90))

#combine four plots together
grid.arrange(weight_distribution, hlength_distribution, weight_sum_plot, 
             hlength_sum_plot, ncol=2, widths=c(6,6))
```

##The Weight and Hindfoot Length Relationship Analysis

###All species

The general pattern of the weight and hindfoot length relationship of all species combined follows the bounded exponential trendline. Based on the R^2^ result, roughly around 72.5% of the population are matched with this trendline. 

```{r plot_c,echo=FALSE}
#load the data
surveys <- read.csv("data/portal_data_joined.csv")

#clean the data from NA and blank value
surveys_complete <- surveys %>%
  filter(!is.na(hindfoot_length)) %>%
  filter(!is.na(weight)) %>%
  filter(sex !="") %>%
  filter(species_id !="")

#plotting the relationship between weight and hindfoot length for all species
plot_1 <- ggplot(surveys_complete, aes(x = weight, y = hindfoot_length, color = genus)) +
  geom_point(shape = 2, size = 1)
plot_2 <- plot_1 + geom_smooth(mapping = aes(linetype = "r2"), 
                               method = "lm",
                               formula = y ~ x + log(x), se = FALSE,
                               color = "red") 
plot_3 <- plot_2 + ggtitle("Relationship between weight and hindfoot length for all species") +
  scale_x_continuous(name = "Weight") + scale_y_continuous(name = "Hindfoot Length")
plot_4 <- plot_3 + theme_minimal() + 
  theme(text = element_text(color = "gray20"), 
        legend.position = c("right"), 
        legend.text = element_text(size = 8, color = "gray20"),
        axis.text = element_text(face = "italic"), 
        axis.title.x = element_text(size = 9, face = "bold", color = "gray20" ),
        axis.title.y = element_text(size = 9, face = "bold", color = "gray20"),
        title = element_text(size = 10, face = "bold", color = "gray20")) 
mR2 <- summary(lm(hindfoot_length ~ weight + log(weight), data = surveys_complete))$r.squared
mR2 <- paste0(format(mR2, digits = 3))
plot_4 + scale_linetype(name = "", breaks = "r2",
                 labels = list(bquote(R^2==.(mR2))), 
                 guide = guide_legend(override.aes = list(linetype = 1, size = 2, color = "red")))
```

###The most recorded species

From the distribution of the number of samples per species in the above, it shows that only four species that have recoded sample above 2500 entries from the period of 1977 to 2002. These species included, baileyi, merriami, ordii and penicillatus. Figures below are the summary of weight and length of hindfoot of the four species. 

```{r plot2,echo=FALSE}
#load the data
surveys <- read.csv("data/portal_data_joined.csv")

#clean the data from NA and blank value
surveys_complete <- surveys %>%
  filter(!is.na(hindfoot_length)) %>%
  filter(!is.na(weight)) %>%
  filter(sex !="") %>%
  filter(species_id !="")

#list of species with n >= 2500
species_count <- surveys_complete %>%
  group_by(species) %>%
  tally() %>%
  filter(n >= 2500)

#filter of the common sample (>= 2500)
surveys_common <- surveys_complete %>%
  filter(species %in% species_count$species)

ggplot(surveys_common, aes(x = species, y = weight)) + geom_boxplot()+xlab("Species")
```

From the results, the ordii species has the highest mean weight among the other, whereas, the merriami species has the highest hindfoot length followed by ordii species in the second place. 

```{r plot3,echo=FALSE}

#load the data
surveys <- read.csv("data/portal_data_joined.csv")

#clean the data from NA and blank value
surveys_complete <- surveys %>%
  filter(!is.na(hindfoot_length)) %>%
  filter(!is.na(weight)) %>%
  filter(sex !="") %>%
  filter(species_id !="")

#list of species with n >= 2500
species_count <- surveys_complete %>%
  group_by(species) %>%
  tally() %>%
  filter(n >= 2500)

#filter of the common sample (>= 2500)
surveys_common <- surveys_complete %>%
  filter(species %in% species_count$species)

ggplot(surveys_common, aes(x = species, y = hindfoot_length)) + geom_boxplot()+xlab("Species")

```

###The linier model of weight and hindfoot length of the merriami species

In order to analyze the weight and hindfoot length relationship thoroughly, we analyze the data from the species which has the most significant sample number which is *merriami* species. The analysis was done using the linear model, as follows:

```{r plot4, echo=FALSE}
#load the data
surveys <- read.csv("data/portal_data_joined.csv") 

#clean the data from NA and blank value
surveys_complete <- surveys %>%
  filter(!is.na(hindfoot_length)) %>%
  filter(!is.na(weight)) %>%
  filter(sex !="") %>%
  filter(species_id !="")

#filter of the common sample (>= 2500)
surveys_common <- surveys_complete %>%
  filter(species %in% species_count$species)

# Linier Model Analysis between weight and hindfoot legth on the most common species

#create object for analysis : 
most_common_data <- surveys_common %>%
  filter(species == "merriami")

weight_vs_length <- select(most_common_data, weight, hindfoot_length)

#fitting linier model between weight and length of hindfoot
lm_weight_vs_length <- lm(hindfoot_length ~ weight, data=most_common_data)

plot(lm_weight_vs_length)
```

The summary of the linear model is listed below:

```{r plot5,echo=FALSE}
#load the data
surveys <- read.csv("data/portal_data_joined.csv") 

#clean the data from NA and blank value
surveys_complete <- surveys %>%
  filter(!is.na(hindfoot_length)) %>%
  filter(!is.na(weight)) %>%
  filter(sex !="") %>%
  filter(species_id !="")

#filter of the common sample (>= 2500)
surveys_common <- surveys_complete %>%
  filter(species %in% species_count$species)

# Linier Model Analysis between weight and hindfoot length on the most common species

#create object for analysis : 
most_common_data <- surveys_common %>%
  filter(species == "merriami")

weight_vs_length <- select(most_common_data, weight, hindfoot_length)

#fitting linier model between weight and length of hindfoot
lm_weight_vs_length <- lm(hindfoot_length ~ weight, data=most_common_data)
summary(lm_weight_vs_length)
```

As we can from the linear model result in the above, the R^2^ shows that roughly around 12% of the population fitted to the linear model. The p-value is smaller than the significance level 0.05 implying that there is no relationship between the mean weight and the hindfoot length of the merriami species. In other words, the size of the hindfoot length is not associated with the weight of this species and vice versa.

###Additional analysis

```{r plot_d,echo=FALSE}
#load the data
surveys <- read.csv("data/portal_data_joined.csv")

#clean the data from NA and blank value
surveys_complete <- surveys %>%
  filter(!is.na(hindfoot_length)) %>%
  filter(!is.na(weight)) %>%
  filter(sex !="") %>%
  filter(species_id !="")

#testing the mean weight between sex to see the difference
#Is the mean weight of female is significantly different compared to the male?
##compute the summary statistic
surveys_complete %>% group_by(sex) %>%
  summarise(count = n(),
            mean = mean(weight),
            sd = sd(weight))
##visualize the data using box plots
ggboxplot(surveys_complete, x = "sex", y = "weight", color = "sex", ylab = "Weight", xlab = "Sex")
##do the two population have the same variances? use "f-test". answer = no because p-value < 0.05
var.test(weight ~ sex, data = surveys_complete)
##is there any significant difference between female and male weights? use "t-test".
##answer = no, because p value > 0.05. (female and male = same)
t.test(weight ~ sex, data = surveys_complete, var.equal = FALSE)

#testing the mean hindfoot length between sex to see the difference
#Is the mean hindfoot length of female is significantly different compared to the male?
##compute the summary statistic
surveys_complete %>% group_by(sex) %>%
  summarise(count = n(),
            mean = mean(hindfoot_length),
            sd = sd(hindfoot_length))
##visualize the data using box plots
ggboxplot(surveys_complete, x = "sex", y = "hindfoot_length", color = "sex", ylab = "Hindfoot Length", xlab = "Sex")
##do the two population have the same variances? use "f-test". answer = no because p-value < 0.05
var.test(hindfoot_length ~ sex, data = surveys_complete)
##is there any significant difference between female and male hindfoot length? use "t-test".
##answer = no, because p value > 0.05. (female and male = same)
t.test(hindfoot_length ~ sex, data = surveys_complete, var.equal = FALSE)

```



